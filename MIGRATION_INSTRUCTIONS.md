# üì¶ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ø–ª–æ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ:

1. **SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞** (`sql/migrate-to-flat-categories.sql`)
   - –ü–µ—Ä–µ–Ω–æ—Å —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π `subcategory_id`
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —É–ø—Ä–æ—â–µ–Ω–Ω—ã—Ö views –∏ —Ñ—É–Ω–∫—Ü–∏–π

2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:**
   - ‚úÖ –°–æ–∑–¥–∞–Ω `SimpleCategorySelector` –≤–º–µ—Å—Ç–æ `HierarchicalCategorySelector`
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `ProductGridByCategory` (—É–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (`app/dashboard/catalog/page.tsx`)

3. **API —É–ø—Ä–æ—â–µ–Ω:**
   - ‚úÖ `/api/catalog/categories/hierarchical` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

4. **–¢–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:**
   - ‚úÖ –£–±—Ä–∞–Ω—ã `subcategories` –∏–∑ —Ç–∏–ø–æ–≤
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ Zod —Å—Ö–µ–º–∞—Ö

## üöÄ –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase:

### –®–∞–≥ 1: –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
SELECT COUNT(*) as total_products FROM catalog_verified_products WHERE subcategory_id IS NOT NULL;
SELECT COUNT(*) as total_products FROM catalog_user_products WHERE subcategory_id IS NOT NULL;
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `sql/migrate-to-flat-categories.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –ø–æ —á–∞—Å—Ç—è–º (–∫–∞–∂–¥—ã–π –±–ª–æ–∫ –æ—Ç–¥–µ–ª—å–Ω–æ)
4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```sql
-- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–º–µ—é—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
SELECT COUNT(*) FROM catalog_verified_products WHERE category_id IS NULL;
SELECT COUNT(*) FROM catalog_user_products WHERE category_id IS NULL;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–≤—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
SELECT * FROM catalog_verified_products_counts;
```

### –®–∞–≥ 4: –î–µ–ø–ª–æ–π –∫–æ–¥–∞
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è (–¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞)
- –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥–æ–π:
  ```sql
  DELETE FROM catalog_categories WHERE level = 2;
  ```

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫):
```sql
-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è subcategory_id
ALTER TABLE catalog_verified_products 
ADD COLUMN IF NOT EXISTS subcategory_id uuid REFERENCES catalog_categories(id);

ALTER TABLE catalog_user_products
ADD COLUMN IF NOT EXISTS subcategory_id uuid REFERENCES catalog_categories(id);

-- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ
UPDATE catalog_categories SET is_active = true WHERE level = 2;
```

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–ª—å–∫–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- –ë—ã—Å—Ç—Ä—ã–µ –∏ —Ç–æ—á–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –ß–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏
- –ú–µ–Ω—å—à–µ –±–∞–≥–æ–≤ –∏ –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞