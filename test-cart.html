<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–æ—Ä–∑–∏–Ω—ã</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9fafb;
            border-radius: 5px;
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .clear-btn {
            background: #ef4444;
        }
        .clear-btn:hover {
            background: #dc2626;
        }
        pre {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∫–æ—Ä–∑–∏–Ω—ã</h1>

        <div class="section">
            <h2>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ localStorage:</h2>
            <pre id="storage-info"></pre>
        </div>

        <div class="section">
            <h2>–î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π:</h2>
            <button onclick="addProduct('supplier1')">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –æ—Ç –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞ 1</button>
            <button onclick="addProduct('supplier2')">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –æ—Ç –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞ 2</button>
            <button onclick="addProduct('supplier3')">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –æ—Ç –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞ 3</button>
            <button class="clear-btn" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>

        <div class="section">
            <h2>–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:</h2>
            <div id="log"></div>
        </div>

        <div class="section">
            <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:</h2>
            <button onclick="checkFiltering()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</button>
            <div id="filter-status"></div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è localStorage
        function updateStorageInfo() {
            const cart = localStorage.getItem('catalog_cart');
            const activeSupplier = localStorage.getItem('catalog_active_supplier');

            const info = {
                cart: cart ? JSON.parse(cart) : [],
                activeSupplier: activeSupplier || null,
                cartLength: cart ? JSON.parse(cart).length : 0
            };

            document.getElementById('storage-info').textContent = JSON.stringify(info, null, 2);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addToLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'status ' + (type === 'success' ? 'success' : type === 'error' ? 'error' : '');
            entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            log.insertBefore(entry, log.firstChild);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        function addProduct(supplierId) {
            let cart = localStorage.getItem('catalog_cart');
            let activeSupplier = localStorage.getItem('catalog_active_supplier');

            cart = cart ? JSON.parse(cart) : [];

            const product = {
                id: 'product_' + Date.now(),
                supplier_id: supplierId,
                supplier_name: '–ü–æ—Å—Ç–∞–≤—â–∏–∫ ' + supplierId.slice(-1),
                product_name: '–¢–æ–≤–∞—Ä –æ—Ç ' + supplierId,
                price: '1000',
                quantity: 1
            };

            if (cart.length === 0 || activeSupplier === supplierId) {
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
                cart.push(product);
                localStorage.setItem('catalog_cart', JSON.stringify(cart));
                localStorage.setItem('catalog_active_supplier', supplierId);
                addToLog(`‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –æ—Ç ${product.supplier_name}`, 'success');
            } else {
                // –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å
                addToLog(`‚ùå –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –æ—Ç ${product.supplier_name}. –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: ${activeSupplier}`, 'error');
            }

            updateStorageInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
        function clearCart() {
            localStorage.removeItem('catalog_cart');
            localStorage.removeItem('catalog_active_supplier');
            addToLog('üóëÔ∏è –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞', 'success');
            updateStorageInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        function checkFiltering() {
            const activeSupplier = localStorage.getItem('catalog_active_supplier');
            const cart = localStorage.getItem('catalog_cart');
            const cartLength = cart ? JSON.parse(cart).length : 0;

            const status = document.getElementById('filter-status');

            if (activeSupplier && cartLength > 0) {
                status.innerHTML = `
                    <div class="status success">
                        <strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –í–ö–õ–Æ–ß–ï–ù–ê</strong><br>
                        –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: ${activeSupplier}<br>
                        –¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ: ${cartLength}<br>
                        –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –æ—Ç ${activeSupplier}
                    </div>
                `;
            } else {
                status.innerHTML = `
                    <div class="status">
                        <strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –û–¢–ö–õ–Æ–ß–ï–ù–ê</strong><br>
                        –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞<br>
                        –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
                    </div>
                `;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateStorageInfo();
        addToLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateStorageInfo, 2000);
    </script>
</body>
</html>