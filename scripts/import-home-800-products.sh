#!/bin/bash

# 🏠 Автоматический импорт 800 товаров для дома через OTAPI
# Использование: ./scripts/import-home-800-products.sh

echo "╔══════════════════════════════════════════════════════════════╗"
echo "║     🏠 ИМПОРТ 800 ТОВАРОВ ДЛЯ КАТЕГОРИИ 'ДОМ И БЫТ'        ║"
echo "╚══════════════════════════════════════════════════════════════╝"
echo ""

# Установка переменной окружения
export OTAPI_INSTANCE_KEY="0e4fb57d-d80e-4274-acc5-f22f354e3577"

# Проверка наличия Node.js
if ! command -v node &> /dev/null; then
    echo "❌ Node.js не установлен!"
    exit 1
fi

# Проверка наличия скрипта импорта
if [ ! -f "scripts/import-from-otapi.js" ]; then
    echo "❌ Скрипт import-from-otapi.js не найден!"
    echo "📍 Убедитесь, что вы находитесь в корневой директории проекта"
    exit 1
fi

# Цветовые коды для красивого вывода
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Счетчики
TOTAL_TARGET=800
TOTAL_IMPORTED=0
BATCH_NUMBER=0

# Функция для импорта с красивым выводом
import_batch() {
    local query=$1
    local limit=$2
    local description=$3

    BATCH_NUMBER=$((BATCH_NUMBER + 1))

    echo ""
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${YELLOW}📦 Партия #$BATCH_NUMBER: $description${NC}"
    echo -e "${BLUE}   Запрос: \"$query\"${NC}"
    echo -e "${BLUE}   Лимит: $limit товаров${NC}"
    echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

    # Выполнение импорта
    node scripts/import-from-otapi.js \
        --query="$query" \
        --category="Дом и быт" \
        --limit=$limit

    # Проверка успешности
    if [ $? -eq 0 ]; then
        TOTAL_IMPORTED=$((TOTAL_IMPORTED + limit))
        echo -e "${GREEN}✅ Успешно импортировано!${NC}"
        echo -e "${PURPLE}📊 Прогресс: $TOTAL_IMPORTED / $TOTAL_TARGET товаров ($(( TOTAL_IMPORTED * 100 / TOTAL_TARGET ))%)${NC}"
    else
        echo -e "${RED}❌ Ошибка при импорте!${NC}"
    fi

    # Пауза между запросами
    echo -e "${YELLOW}⏳ Пауза 3 секунды перед следующим запросом...${NC}"
    sleep 3
}

# Начало импорта
echo -e "${GREEN}🚀 Начинаем импорт товаров...${NC}"
echo ""

# ========== МЕБЕЛЬ ДЛЯ ГОСТИНОЙ (100) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║   1. МЕБЕЛЬ ДЛЯ ГОСТИНОЙ (100)    ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "диван кресло мягкая мебель" 40 "Мягкая мебель"
import_batch "журнальный столик стол стеклянный" 30 "Столы и тумбы"
import_batch "стеллаж книжный шкаф полки" 30 "Системы хранения"

# ========== МЕБЕЛЬ ДЛЯ СПАЛЬНИ (80) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║   2. МЕБЕЛЬ ДЛЯ СПАЛЬНИ (80)      ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "кровать двуспальная матрас ортопедический" 40 "Кровати и матрасы"
import_batch "комод тумбочка прикроватная" 20 "Комоды и тумбочки"
import_batch "шкаф купе гардероб зеркало" 20 "Шкафы"

# ========== КУХОННАЯ ТЕХНИКА (100) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║    3. КУХОННАЯ ТЕХНИКА (100)      ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "блендер миксер измельчитель" 50 "Мелкая техника"
import_batch "посуда набор кастрюля сковорода" 30 "Посуда"
import_batch "мультиварка пароварка гриль" 20 "Техника для готовки"

# ========== ТЕКСТИЛЬ (100) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║    4. ТЕКСТИЛЬ ДЛЯ ДОМА (100)     ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "постельное белье комплект сатин хлопок" 40 "Постельное белье"
import_batch "шторы занавески тюль blackout" 30 "Шторы"
import_batch "полотенце банное махровое халат" 30 "Полотенца"

# ========== ОСВЕЩЕНИЕ (80) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║       5. ОСВЕЩЕНИЕ (80)           ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "люстра потолочная LED современная" 40 "Люстры"
import_batch "настольная лампа светильник" 20 "Настольные лампы"
import_batch "уличный фонарь садовый светильник" 20 "Уличное освещение"

# ========== ДЕКОР (100) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║    6. ДЕКОР И ИНТЕРЬЕР (100)      ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "картина постер модульная рамка" 30 "Картины"
import_batch "ваза декоративная статуэтка фигурка" 30 "Декоративные элементы"
import_batch "часы настенные зеркало декор" 40 "Часы и зеркала"

# ========== СИСТЕМЫ ХРАНЕНИЯ (80) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║   7. СИСТЕМЫ ХРАНЕНИЯ (80)        ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "корзина контейнер ящик хранение" 40 "Контейнеры"
import_batch "органайзер вешалка крючки" 40 "Органайзеры"

# ========== УМНЫЙ ДОМ (80) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║      8. УМНЫЙ ДОМ (80)            ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "умная лампа RGB WiFi smart" 30 "Умное освещение"
import_batch "камера видеонаблюдение датчик" 30 "Безопасность"
import_batch "умная розетка таймер smart plug" 20 "Умные розетки"

# ========== САНТЕХНИКА (80) ==========
echo -e "${PURPLE}╔════════════════════════════════════╗${NC}"
echo -e "${PURPLE}║      9. САНТЕХНИКА (80)           ║${NC}"
echo -e "${PURPLE}╚════════════════════════════════════╝${NC}"

import_batch "смеситель кран душевая система" 40 "Смесители"
import_batch "полотенцесушитель держатель мыльница" 40 "Аксессуары"

# ========== ЗАВЕРШЕНИЕ ==========
echo ""
echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${GREEN}🎉 ИМПОРТ ЗАВЕРШЕН!${NC}"
echo -e "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
echo -e "${YELLOW}📊 ИТОГОВАЯ СТАТИСТИКА:${NC}"
echo -e "   ${BLUE}Целевое количество: ${TOTAL_TARGET} товаров${NC}"
echo -e "   ${GREEN}Импортировано: ${TOTAL_IMPORTED} товаров${NC}"
echo -e "   ${PURPLE}Выполнено партий: ${BATCH_NUMBER}${NC}"

if [ $TOTAL_IMPORTED -ge $TOTAL_TARGET ]; then
    echo -e "   ${GREEN}✅ Цель достигнута!${NC}"
else
    REMAINING=$((TOTAL_TARGET - TOTAL_IMPORTED))
    echo -e "   ${YELLOW}⚠️ Осталось импортировать: ${REMAINING} товаров${NC}"
fi

echo ""
echo -e "${CYAN}💡 Проверьте результат:${NC}"
echo -e "   ${BLUE}psql \$DATABASE_URL -c \"SELECT COUNT(*) FROM catalog_verified_products WHERE category='Дом и быт';\"${NC}"
echo -e "   ${BLUE}Откройте: http://localhost:3000/dashboard/catalog?category=Дом%20и%20быт${NC}"
echo ""

exit 0