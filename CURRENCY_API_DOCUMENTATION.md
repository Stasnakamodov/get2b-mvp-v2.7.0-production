# üí± –í–∞–ª—é—Ç–Ω—ã–π API Get2B - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

*–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¶–ë –†–§ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç*

---

## üéØ **–û–±–∑–æ—Ä**

–í–∞–ª—é—Ç–Ω—ã–π API Get2B –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –æ—Ç –¶–µ–Ω—Ç—Ä–æ–±–∞–Ω–∫–∞ –†–§ —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.

### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üìä –†–µ–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –¶–ë –†–§ —á–µ—Ä–µ–∑ `cbr-xml-daily.ru`
- üïí –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 1 —á–∞—Å + –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- üîÑ Fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫—É—Ä—Å—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏
- ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AI-–æ—Ç–≤–µ—Ç—ã —á–∞—Ç-–±–æ—Ç–∞
- üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ (‚ñ≤‚ñº)

---

## üõ†Ô∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```
üìÅ lib/services/CurrencyService.ts    - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
üìÅ app/api/currency/rates/route.ts    - REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
üìÅ lib/utils/currency.ts              - –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
üìÅ app/test-currency/page.tsx         - –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```

### **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
–¶–ë –†–§ API ‚Üí CurrencyService ‚Üí –ö–µ—à ‚Üí REST API ‚Üí AI/Frontend
    ‚Üì              ‚Üì            ‚Üì        ‚Üì         ‚Üì
cbr-xml-daily ‚Üí Singleton ‚Üí Memory ‚Üí Routes ‚Üí Responses
```

---

## üîå **API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**

### **GET /api/currency/rates**

–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç Get2B.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `refresh=true` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞
- `currencies=USD,EUR` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤–∞–ª—é—Ç–∞–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl "http://localhost:3000/api/currency/rates?refresh=true&currencies=USD,EUR"
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "date": "2025-07-23T11:30:00+03:00",
  "rates": {
    "USD": {
      "code": "USD",
      "name": "–î–æ–ª–ª–∞—Ä –°–®–ê", 
      "value": 78.0882,
      "nominal": 1,
      "previous": 78.3274,
      "trend": "down"
    },
    "EUR": {
      "code": "EUR",
      "name": "–ï–≤—Ä–æ",
      "value": 91.7782,
      "nominal": 1, 
      "previous": 91.5138,
      "trend": "up"
    }
  },
  "source": "cbr",
  "updated_at": "2025-07-22T21:31:01.499Z",
  "meta": {
    "cache_duration": "1 hour",
    "last_updated": "2025-07-22T21:31:01.499Z",
    "available_currencies": ["USD", "EUR", "CNY", "TRY", "AED"],
    "api_version": "1.0",
    "get2b_integration": true
  }
}
```

**HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏:**
- `Cache-Control: public, max-age=3600`
- `X-Source: cbr|cache|fallback`
- `X-Updated: 2025-07-22T21:31:01.499Z`

### **POST /api/currency/rates**

–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "amount": 1000,
  "from": "USD", 
  "to": "RUB"
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "conversion": {
    "amount": 78088.2,
    "rate": 78.0882,
    "fromCurrency": "USD",
    "toCurrency": "RUB"
  },
  "timestamp": "2025-07-22T21:31:02.961Z"
}
```

---

## üîß **CurrencyService API**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (Singleton)
const service = CurrencyService.getInstance();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤
const rates = await service.getRates(forceRefresh?: boolean);

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç
const result = await service.convert(1000, 'USD', 'RUB');

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞
const formatted = service.formatRate('USD', rate);

// –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
service.clearCache();
```

### **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**

```typescript
interface CurrencyRate {
  code: string;
  name: string;
  value: number;
  nominal: number;
  previous?: number;
  trend?: 'up' | 'down' | 'stable';
}

interface CurrencyRatesResponse {
  date: string;
  rates: Record<string, CurrencyRate>;
  source: 'cbr' | 'cache' | 'fallback';
  updated_at: string;
}
```

---

## üí∞ **–í–∞–ª—é—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**

### **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```typescript
import { formatCurrency, formatCurrencyWithFlag } from '@/lib/utils/currency';

// –ë–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
formatCurrency(1000, 'USD'); // "$1,000.00"
formatCurrency(1000, 'RUB'); // "1 000,00 ‚ÇΩ"

// –° —Ñ–ª–∞–≥–æ–º —Å—Ç—Ä–∞–Ω—ã
formatCurrencyWithFlag(1000, 'USD'); // "üá∫üá∏ $1,000.00"
formatCurrencyWithFlag(1000, 'USD', true); // "üá∫üá∏ $1,000.00 –î–æ–ª–ª–∞—Ä –°–®–ê"
```

### **–í–∞–ª–∏–¥–∞—Ü–∏—è:**

```typescript
import { isValidCurrency, parseAmount } from '@/lib/utils/currency';

// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã
isValidCurrency('USD'); // true
isValidCurrency('XYZ'); // false

// –ü–∞—Ä—Å–∏–Ω–≥ —Å—É–º–º—ã
parseAmount('1000 USD'); // { amount: 1000, currency: 'USD' }
parseAmount('1,000.50 $'); // { amount: 1000.5, currency: 'USD' }
```

### **–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π Get2B:**

```typescript
import { calculateGet2BFee, getFeeTier } from '@/lib/utils/currency';

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏—Ä–∞
const tier = getFeeTier(2000000, 'RUB'); // 'standard'

// –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏
const feeCalc = calculateGet2BFee(1000000, 'RUB', 'standard');
// { fee: 100000, feePercent: 10, totalAmount: 1100000 }
```

---

## ü§ñ **AI –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã:**

AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö:
- "–∫—É—Ä—Å—ã –≤–∞–ª—é—Ç", "–∫–∞–∫–∏–µ –∫—É—Ä—Å—ã", "–¥–æ–ª–ª–∞—Ä –µ–≤—Ä–æ"
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–Ω–¥—ã —Å –∏–∫–æ–Ω–∫–∞–º–∏ ‚ñ≤‚ñº
- –£–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AI:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–∫–∞–∫–∏–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç —Å–µ–≥–æ–¥–Ω—è?"
AI: "üí± –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –æ—Ç –¶–ë –†–§:
     üá∫üá∏ 1 USD = 78.0882 ‚ÇΩ ‚ñº
     üá™üá∫ 1 EUR = 91.7782 ‚ÇΩ ‚ñ≤
     ..."
```

---

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:**
`/test-currency` - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å:
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫—É—Ä—Å–æ–≤ —Å —Ç—Ä–µ–Ω–¥–∞–º–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º AI –æ—Ç–≤–µ—Ç–æ–≤
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤–∞–ª—é—Ç
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

### **–ü—Ä–∏–º–µ—Ä—ã cURL:**

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫—É—Ä—Å–æ–≤
curl "http://localhost:3000/api/currency/rates"

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
curl "http://localhost:3000/api/currency/rates?refresh=true"

# –§–∏–ª—å—Ç—Ä –≤–∞–ª—é—Ç
curl "http://localhost:3000/api/currency/rates?currencies=USD,EUR"

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
curl -X POST "http://localhost:3000/api/currency/rates" \
  -H "Content-Type: application/json" \
  -d '{"amount":1000,"from":"USD","to":"RUB"}'

# AI –æ—Ç–≤–µ—Ç —Å –∫—É—Ä—Å–∞–º–∏
curl -X POST "http://localhost:3000/api/chat/ai-response" \
  -H "Content-Type: application/json" \
  -d '{"message":"–∫—É—Ä—Å—ã –≤–∞–ª—é—Ç","context":"general"}'
```

---

## üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

### **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ: 1 —á–∞—Å (60 –º–∏–Ω—É—Ç)
- –¢–∞–π–º–∞—É—Ç API: 5 —Å–µ–∫—É–Ω–¥
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã: USD, EUR, CNY, TRY, AED
- Fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¶–ë –†–§

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`source`: cbr/cache/fallback)
- Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```typescript
try {
  const rates = await service.getRates();
} catch (error) {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫—É—Ä—Å—ã
  console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤:', error);
}
```

---

## üöÄ **Roadmap**

### **–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–∞–ª—é—Ç
- [ ] WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤
- [ ] –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ Get2B –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫—É—Ä—Å–æ–≤

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Get2B:**
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–≥–æ–¥–Ω—ã—Ö –∫—É—Ä—Å–∞—Ö –¥–ª—è –∑–∞–∫—É–ø–æ–∫
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞–ª—é—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

**üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:** –í–æ–ø—Ä–æ—Å—ã –ø–æ API - @get2b-dev-team 