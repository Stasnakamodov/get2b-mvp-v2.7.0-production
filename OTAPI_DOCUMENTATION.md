# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OTAPI (OTCommerce)

## üîë –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**OTAPI (OpenTrade Commerce API)** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∏—Ç–∞–π—Å–∫–∏–º–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏ (Taobao, 1688, Alibaba, AliExpress). –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü.

### –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **API –∫–ª—é—á**: `0e4fb57d-d80e-4274-acc5-f22f354e3577`
- **–ë–∞–∑–æ–≤—ã–π URL**: `https://otapi.net/service/v2/`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://docs.otapi.net/ru
- **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤**: https://links.otcommerce.com/examplesrus

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 10 –¥–µ–∫–∞–±—Ä—è!

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/lib/services/
  ‚îî‚îÄ‚îÄ OtapiService.ts         # TypeScript —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API

/scripts/
  ‚îú‚îÄ‚îÄ import-from-otapi.js    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
  ‚îî‚îÄ‚îÄ test-otapi.js          # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

/app/api/catalog/import-from-otapi/
  ‚îî‚îÄ‚îÄ route.ts               # API endpoint –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. OtapiService.ts
TypeScript —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OTAPI:

```typescript
// –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- searchItems()      // –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
- getItemDetails()   // –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
- getCategories()    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```

### 2. –°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞ (import-from-otapi.js)
–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ OTAPI –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
node scripts/import-from-otapi.js \
  --query="—Å–º–∞—Ä—Ç—Ñ–æ–Ω" \
  --category="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" \
  --limit=50

# –° –≤—ã–±–æ—Ä–æ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
node scripts/import-from-otapi.js \
  --provider=1688 \
  --query="wholesale" \
  --category="–û–ø—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã"
```

## üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã

| –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å | Provider | –ü—Ä–µ—Ñ–∏–∫—Å ID | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|----------|------------|-------------|
| Taobao | `Taobao` | - | –†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è, —à–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç |
| 1688 | `1688` | `abb-` | –û–ø—Ç–æ–≤—ã–µ –∑–∞–∫—É–ø–∫–∏, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏ |
| Alibaba | `Alibaba` | `alb-` | –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è, B2B |
| AliExpress | `AliExpress` | - | –†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ |

## üõ†Ô∏è API –º–µ—Ç–æ–¥—ã

### SearchItemsFrame
–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:

```javascript
const params = {
  instanceKey: '0e4fb57d-d80e-4274-acc5-f22f354e3577',
  language: 'ru',
  xmlParameters: `
    <SearchItemsParameters>
      <Provider>Taobao</Provider>
      <SearchMethod>Catalog</SearchMethod>
      <ItemTitle>–ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</ItemTitle>
      <MinPrice>100</MinPrice>
      <MaxPrice>10000</MaxPrice>
      <ItemsPerPage>50</ItemsPerPage>
    </SearchItemsParameters>
  `
}
```

### –û—Ç–≤–µ—Ç API
```json
{
  "Result": {
    "Items": {
      "Content": [
        {
          "Title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
          "Price": { "OriginalPrice": "100.00" },
          "MainPictureUrl": "https://...",
          "VendorName": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
          "VendorId": "123456",
          "Id": "item_id",
          "ExternalItemUrl": "https://item.taobao.com/..."
        }
      ]
    },
    "SearchProperties": {
      "TotalCount": 1000
    }
  }
}
```

## üì¶ –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
SELECT DISTINCT category, COUNT(*)
FROM catalog_verified_products
GROUP BY category;
```

### 2. –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```javascript
node scripts/import-from-otapi.js --clean --category="–ù–ê–ó–í–ê–ù–ò–ï_–ö–ê–¢–ï–ì–û–†–ò–ò"
```

### 3. –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
```bash
# –ü–∞–∫–µ—Ç–Ω—ã–π –∏–º–ø–æ—Ä—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
node scripts/import-from-otapi.js \
  --query="–º–µ–±–µ–ª—å –¥–ª—è –¥–æ–º–∞" \
  --category="–î–æ–º –∏ –±—ã—Ç" \
  --limit=50 \
  --batch=true

# –ò–º–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ü–µ–Ω–µ
node scripts/import-from-otapi.js \
  --query="–∫—É—Ö–æ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞" \
  --category="–î–æ–º –∏ –±—ã—Ç" \
  --minPrice=1000 \
  --maxPrice=50000 \
  --limit=100
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–º–ø–æ—Ä—Ç–∞
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
SELECT
  category,
  COUNT(*) as total,
  COUNT(DISTINCT supplier_id) as suppliers,
  AVG(CAST(price AS DECIMAL)) as avg_price
FROM catalog_verified_products
WHERE category = '–î–æ–º –∏ –±—ã—Ç'
GROUP BY category;
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è

### Batch-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
```bash
#!/bin/bash
# batch-import.sh

CATEGORIES=(
  "–º–µ–±–µ–ª—å –¥–ª—è –¥–æ–º–∞:50"
  "–∫—É—Ö–æ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞:100"
  "–¥–µ–∫–æ—Ä –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä:50"
  "—Ç–µ–∫—Å—Ç–∏–ª—å –¥–ª—è –¥–æ–º–∞:100"
  "–æ—Å–≤–µ—â–µ–Ω–∏–µ:50"
  "—Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞:50"
  "–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:100"
  "—Å–∞–¥–æ–≤–∞—è –º–µ–±–µ–ª—å:50"
  "—É–º–Ω—ã–π –¥–æ–º:100"
  "—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:100"
)

for item in "${CATEGORIES[@]}" ; do
  query="${item%%:*}"
  limit="${item##*:}"

  echo "–ò–º–ø–æ—Ä—Ç: $query (–ª–∏–º–∏—Ç: $limit)"
  node scripts/import-from-otapi.js \
    --query="$query" \
    --category="–î–æ–º –∏ –±—ã—Ç" \
    --limit=$limit

  sleep 5 # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
done
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –õ–∏–º–∏—Ç—ã API
- –ú–∞–∫—Å–∏–º—É–º 100 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å
- –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á: 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏: 2-5 —Å–µ–∫—É–Ω–¥

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```javascript
// –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ —Å–∫—Ä–∏–ø—Ç–µ
if (response.ErrorCode) {
  switch(response.ErrorCode) {
    case 'TooManyRequests':
      // –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
      await sleep(5000);
      break;
    case 'InvalidKey':
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á API
      console.error('–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á API');
      break;
  }
}
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞—Ç—á–∏**: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ 50-100 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ —Ä–∞–∑
2. **–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —Ü–µ–Ω–µ**: –ò—Å–∫–ª—é—á–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º –¥–µ—à–µ–≤—ã–µ/–¥–æ—Ä–æ–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `item_code` –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. **–ö–µ—à–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤ Supabase Storage

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Dashboard –∑–∞–ø—Ä–æ—Å—ã
```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT
  category,
  COUNT(*) as products,
  COUNT(DISTINCT supplier_id) as suppliers,
  MIN(created_at) as first_import,
  MAX(created_at) as last_import
FROM catalog_verified_products
GROUP BY category
ORDER BY products DESC;

-- –¢–æ–ø –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
SELECT
  supplier_id,
  supplier_name,
  COUNT(*) as product_count,
  AVG(CAST(price AS DECIMAL)) as avg_price
FROM catalog_verified_products
GROUP BY supplier_id, supplier_name
ORDER BY product_count DESC
LIMIT 10;
```

## üöÄ Quick Start

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–º–∞:
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
export OTAPI_INSTANCE_KEY=0e4fb57d-d80e-4274-acc5-f22f354e3577

# 2. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
node scripts/test-otapi.js

# 3. –ò–º–ø–æ—Ä—Ç –ø–µ—Ä–≤–æ–π –ø–∞—Ä—Ç–∏–∏
node scripts/import-from-otapi.js \
  --query="–º–µ–±–µ–ª—å –≥–æ—Å—Ç–∏–Ω–∞—è –¥–∏–≤–∞–Ω" \
  --category="–î–æ–º –∏ –±—ã—Ç" \
  --limit=50

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
psql $DATABASE_URL -c "SELECT COUNT(*) FROM catalog_verified_products WHERE category='–î–æ–º –∏ –±—ã—Ç';"
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–î–æ–º –∏ –±—ã—Ç":
- `–º–µ–±–µ–ª—å –¥–ª—è –≥–æ—Å—Ç–∏–Ω–æ–π`
- `–∫—É—Ö–æ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞`
- `–ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ`
- `–¥–µ–∫–æ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞`
- `–æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–ª—è –¥–æ–º–∞`
- `–∫–æ–≤—Ä—ã –∏ —Ç–µ–∫—Å—Ç–∏–ª—å`
- `–ø–æ—Å—É–¥–∞ –∏ –∫—É—Ö–æ–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏`
- `—Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è`
- `—É–º–Ω—ã–π –¥–æ–º –≥–∞–¥–∂–µ—Ç—ã`
- `—Å–∞–¥–æ–≤–∞—è –º–µ–±–µ–ª—å`

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
// –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
process.env.DEBUG = 'otapi:*';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ API
```bash
# –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API
curl -X POST https://otapi.net/service/v2/SearchItemsFrame \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "instanceKey=0e4fb57d-d80e-4274-acc5-f22f354e3577&language=ru&xmlParameters=..."
```

---

üìÖ **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –î–µ–∫–∞–±—Ä—å 2024
üîê **–ö–ª—é—á –∏—Å—Ç–µ–∫–∞–µ—Ç**: 10 –¥–µ–∫–∞–±—Ä—è 2024
üìß **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: support@otapi.net