# Настройка Telegram бота для Get2B

## Обзор

Приложение Get2B использует Telegram бота для отправки уведомлений менеджерам о различных этапах проекта. Telegram интеграция является **опциональной** - приложение работает без неё, но уведомления не отправляются.

## Быстрый старт

Если вы хотите запустить приложение **без Telegram интеграции**:

1. Не создавайте файл `.env.local` или оставьте переменные Telegram пустыми
2. Приложение будет работать нормально, но уведомления в Telegram отправляться не будут
3. В консоли браузера вы увидите сообщения типа "Отправка в Telegram пропущена (не настроен)"

## Полная настройка Telegram

### Шаг 1: Создание бота

1. Откройте Telegram и найдите бота @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен (например: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### Шаг 2: Получение Chat ID

1. Добавьте вашего бота в группу или напишите ему личное сообщение
2. Отправьте любое сообщение боту
3. Откройте в браузере: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найдите в ответе поле `chat.id` (например: `-1001234567890` для группы или `123456789` для личного чата)

### Шаг 3: Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```env
# Supabase (обязательно)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Telegram Bot (опционально)
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=-1001234567890

# Другие переменные
NODE_ENV=development
```

### Шаг 4: Перезапуск приложения

```bash
npm run dev
```

## Функциональность Telegram бота

Когда Telegram настроен, бот отправляет уведомления на следующих этапах:

1. **Шаг 2:** Отправка спецификации на проверку менеджеру
2. **Шаг 3:** Загрузка чека клиентом для одобрения
3. **Шаг 5:** Запрос менеджеру на загрузку чека для клиента
4. **Шаг 6:** Подтверждение получения средств клиентом

## Диагностика проблем

### Проблема: "Failed to send supplier receipt request"

**Решение:** Эта ошибка исправлена в последней версии. Приложение теперь работает без Telegram.

### Проблема: Сообщения не отправляются

1. Проверьте переменные окружения в `.env.local`
2. Убедитесь, что бот добавлен в чат/группу
3. Проверьте логи в консоли браузера на предмет ошибок Telegram API

### Проблема: Неверный Chat ID

1. Отправьте сообщение боту
2. Проверьте `https://api.telegram.org/bot<TOKEN>/getUpdates`
3. Обновите `TELEGRAM_CHAT_ID` в `.env.local`

## Webhook (опционально)

Для обработки ответов от менеджеров через Telegram используется webhook:

```bash
# Установка webhook (только для продакшена)
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-domain.com/api/telegram-webhook"}'
```

## Безопасность

- Никогда не коммитьте `.env.local` в репозиторий
- Используйте разные боты для development и production
- Регулярно обновляйте токены ботов 