# üíæ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è

## üö® –ü–†–û–ë–õ–ï–ú–ê (–ë–´–õ–û)
–°–æ–æ–±—â–µ–Ω–∏—è –∏—Å—á–µ–∑–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏ —á–∞—Ç–∞:
- –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–Ω–∞—Ç—ã –≤—ã–∑—ã–≤–∞–ª—Å—è `resetChat()` –∫–æ—Ç–æ—Ä—ã–π –æ—á–∏—â–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è 
- –ó–∞—Ç–µ–º `loadMessages()` –∑–∞–≥—Ä—É–∂–∞–ª –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ API
- –ï—Å–ª–∏ API –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–ª - —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–ø–∞–¥–∞–ª–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –ø—É—Å—Ç–æ–π —á–∞—Ç –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–º–Ω–∞—Ç–µ

## ‚úÖ –†–ï–®–ï–ù–ò–ï (–°–¢–ê–õ–û)

### 1. –î–æ–±–∞–≤–ª–µ–Ω –∫—ç—à —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º
```typescript
// –í hooks/useChat.ts
const messagesCache = useRef<Record<string, ChatMessage[]>>({});
```

### 2. –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
```typescript
// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
if (roomId) {
  messagesCache.current[roomId] = uniqueMessages;
  console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–∏–ª–∏ ${uniqueMessages.length} —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫—ç—à –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã ${roomId}`);
}

// –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
setMessages(prev => {
  const updated = [...prev, data.message];
  if (roomId) {
    messagesCache.current[roomId] = updated;
  }
  return updated;
});

// –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ AI –æ—Ç–≤–µ—Ç–∞
// –ü—Ä–∏ polling –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
// –í–µ–∑–¥–µ –≥–¥–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è
```

### 3. –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç
```typescript
// –ë–´–õ–û: –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–ª–∏, –ø–æ—Ç–æ–º –∑–∞–≥—Ä—É–∂–∞–ª–∏
resetChat();
loadMessages({ limit, offset: 0 });

// –°–¢–ê–õ–û: –°–Ω–∞—á–∞–ª–∞ –∫—ç—à, –ø–æ—Ç–æ–º –¥–æ–∑–∞–≥—Ä—É–∑–∫–∞
const cachedMessages = messagesCache.current[roomId];
if (cachedMessages && cachedMessages.length > 0) {
  console.log(`üíæ –ó–∞–≥—Ä—É–∂–∞–µ–º ${cachedMessages.length} —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫—ç—à–∞`);
  setMessages(cachedMessages);
  
  // –í—Å–µ —Ä–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤ —Ñ–æ–Ω–µ
  loadMessages({ limit, offset: 0 });
} else {
  // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç - –æ—á–∏—â–∞–µ–º
  resetChat();
  loadMessages({ limit, offset: 0 });
}
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å AI, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —á–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ —á–∞—Ç—É —Å AI
4. **–û–ñ–ò–î–ê–ù–ò–ï**: –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ –ú–ì–ù–û–í–ï–ù–ù–û

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–µ–¥–ª–µ–Ω–Ω—ã–π API
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç—É
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –∫–æ–º–Ω–∞—Ç—É (–¥–∞–∂–µ –µ—Å–ª–∏ API –º–µ–¥–ª–µ–Ω–Ω—ã–π)
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –ø–µ—Ä–≤–æ–π –∫–æ–º–Ω–∞—Ç–µ
4. **–û–ñ–ò–î–ê–ù–ò–ï**: –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –∏–∑ –∫—ç—à–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ AI –∫–æ–º–Ω–∞—Ç–µ
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –∫–æ–º–Ω–∞—Ç—É
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ AI –∫–æ–º–Ω–∞—Ç–µ
4. **–û–ñ–ò–î–ê–ù–ò–ï**: –ò —Å—Ç–∞—Ä—ã–µ, –∏ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

## üìä –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

**–ë–´–õ–û:**
- –ö–∞–∂–¥–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ = –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ + –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º API
- –°–æ–æ–±—â–µ–Ω–∏—è –∏—Å—á–µ–∑–∞–ª–∏ –∏ –ø–æ—è–≤–ª—è–ª–∏—Å—å

**–°–¢–ê–õ–û:**
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞
- API –∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Ñ–æ–Ω–µ –¥–ª—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- –°–æ–æ–±—â–µ–Ω–∏—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å—á–µ–∑–∞—é—Ç
- –ü–ª–∞–≤–Ω—ã–π UX –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç

## ‚ú® –†–ï–ó–£–õ–¨–¢–ê–¢

üéâ **–°–û–û–ë–©–ï–ù–ò–Ø –ë–û–õ–¨–®–ï –ù–ï –ò–°–ß–ï–ó–ê–Æ–¢!**

- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π  
- ‚úÖ –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º API
- ‚úÖ –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ + —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

**–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê! üöÄ** 