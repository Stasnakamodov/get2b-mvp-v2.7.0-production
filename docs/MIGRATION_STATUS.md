# üìä –°—Ç–∞—Ç—É—Å –ú–∏–≥—Ä–∞—Ü–∏–∏ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –ö–∞—Ç–µ–≥–æ—Ä–∏–π

**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, PostgREST cache –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ó–∞–¥–∞—á–∏

### 1. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (100% –≥–æ—Ç–æ–≤–æ)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `catalog_categories` —Å –ø–æ–ª–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `parent_id`, `level`, `slug`, `full_path`, `products_count`, `suppliers_count`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 4 —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
  - `update_category_full_path` - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏
  - `update_products_count` - –ø–æ–¥—Å—á—ë—Ç —Ç–æ–≤–∞—Ä–æ–≤
  - `update_suppliers_count` - –ø–æ–¥—Å—á—ë—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
  - `update_has_subcategories` - —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ SQL —Ñ—É–Ω–∫—Ü–∏—è `get_category_tree()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `get_categories_json()` –∏ `get_all_categories()` –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞

### 2. –î–∞–Ω–Ω—ã–µ (100% –≥–æ—Ç–æ–≤–æ)
- ‚úÖ **8 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (level 0):**
  1. –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ üì±
  2. –ê–≤—Ç–æ—Ç–æ–≤–∞—Ä—ã üöó
  3. –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å ‚öôÔ∏è
  4. –ó–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω–∞ üè•
  5. –¢–µ–∫—Å—Ç–∏–ª—å –∏ –æ–¥–µ–∂–¥–∞ üëï
  6. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ üèóÔ∏è
  7. –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è üçΩÔ∏è
  8. –î–æ–º –∏ –±—ã—Ç üè†

- ‚úÖ **33 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (level 1):**
  - –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞: –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –ø–ª–∞–Ω—à–µ—Ç—ã, –ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏, –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
  - –ê–≤—Ç–æ—Ç–æ–≤–∞—Ä—ã: –ê–≤—Ç–æ—Ö–∏–º–∏—è, –ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏, –®–∏–Ω—ã –∏ –¥–∏—Å–∫–∏, –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã
  - –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å: –°—Ç–∞–Ω–∫–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∞, –†–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
  - –ó–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω–∞: –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è, –§–∞—Ä–º–∞—Ü–µ–≤—Ç–∏–∫–∞, –ú–µ–¥–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
  - –¢–µ–∫—Å—Ç–∏–ª—å: –¢–∫–∞–Ω–∏, –û–¥–µ–∂–¥–∞ –æ–ø—Ç–æ–º, –î–æ–º–∞—à–Ω–∏–π —Ç–µ–∫—Å—Ç–∏–ª—å, –°–ø–µ—Ü–æ–¥–µ–∂–¥–∞
  - –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ: –°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞, –≠–ª–µ–∫—Ç—Ä–∏–∫–∞
  - –ü—Ä–æ–¥—É–∫—Ç—ã: –ù–∞–ø–∏—Ç–∫–∏, –ë–∞–∫–∞–ª–µ—è, –ö–æ–Ω—Å–µ—Ä–≤–∞—Ü–∏—è, –ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
  - –î–æ–º –∏ –±—ã—Ç: –ü–æ—Å—É–¥–∞, –ú–µ–±–µ–ª—å, –î–µ–∫–æ—Ä, –•–æ–∑—Ç–æ–≤–∞—Ä—ã

**–ò—Ç–æ–≥–æ:** 41 –∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –ë–î

### 3. API Endpoints (–≥–æ—Ç–æ–≤—ã)
–°–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

1. **`/api/catalog/categories`** - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `?level=0|1|2`, `?includeTree=true|false`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –¥–µ—Ä–µ–≤–æ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

2. **`/api/catalog/category-tree`** - –¥–µ—Ä–µ–≤–æ —á–µ—Ä–µ–∑ SQL —Ñ—É–Ω–∫—Ü–∏—é
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞

3. **`/api/catalog/categories-direct`** - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π endpoint
   - –û–±—Ö–æ–¥–∏—Ç PostgREST –∫—ç—à (—Å–æ–∑–¥–∞–Ω –∫–∞–∫ fallback)

4. **`/api/catalog/categories-v2`** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è –ü—Ä–æ–±–ª–µ–º–∞: PostgREST Schema Cache

### –ß—Ç–æ –ü—Ä–æ–∏–∑–æ—à–ª–æ:
PostgREST (REST API —Å–ª–æ–π Supabase) –∫—ç—à–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (`parent_id`, `level`, `slug`, `full_path` –∏ —Ç.–¥.) –∏ —Ñ—É–Ω–∫—Ü–∏–∏, PostgREST –Ω–µ –≤–∏–¥–∏—Ç –∏—Ö –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞.

### –°–∏–º–ø—Ç–æ–º—ã:
```json
{
  "error": "column catalog_categories.level does not exist"
}
```

–ò–ª–∏:
```json
{
  "error": "Could not find the function public.get_categories_json in the schema cache"
}
```

### –ü–æ—á–µ–º—É –≠—Ç–æ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ MCP (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL) ‚úÖ
- PostgREST –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫—ç—à —Å—Ö–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 10-15 –º–∏–Ω—É—Ç
  - –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞ PostgREST
  - –ü–æ –∫–æ–º–∞–Ω–¥–µ `NOTIFY pgrst, 'reload schema'` (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ hosted Supabase)

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
–ü—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ MCP —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ:
```sql
SELECT id, name, level, parent_id, full_path
FROM catalog_categories
WHERE level = 1
LIMIT 3;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ –ê–≤—Ç–æ—Ö–∏–º–∏—è (level: 1, parent: –ê–≤—Ç–æ—Ç–æ–≤–∞—Ä—ã, path: "–ê–≤—Ç–æ—Ç–æ–≤–∞—Ä—ã / –ê–≤—Ç–æ—Ö–∏–º–∏—è")
‚úÖ –ü–æ—Å—É–¥–∞ (level: 1, parent: –î–æ–º –∏ –±—ã—Ç, path: "–î–æ–º –∏ –±—ã—Ç / –ü–æ—Å—É–¥–∞")
‚úÖ –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –ø–ª–∞–Ω—à–µ—Ç—ã (level: 1, parent: –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, path: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ / –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –ø–ª–∞–Ω—à–µ—Ç—ã")
```

---

## üîß –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–¥–æ–∂–¥–∞—Ç—å (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫—ç—à –≤ —Ç–µ—á–µ–Ω–∏–µ **10-15 –º–∏–Ω—É—Ç** –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ú–∏–≥—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:** ~17:45 MSK
**–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** 20:36 MSK
**–°—Ç–∞—Ç—É—Å:** –ö—ç—à –¥–æ–ª–∂–µ–Ω –±—ã–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è, –Ω–æ –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—á–µ—Ä–µ–∑ Supabase Dashboard)
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard: https://supabase.com/dashboard/project/ejkhdhexkadecpbjjmsz
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí API
3. –ù–∞–∂–º–∏—Ç–µ "Restart API" (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–µ–∑–µ—Ä–≤–Ω—ã–π Endpoint (–≤—Ä–µ–º–µ–Ω–Ω–æ)
–î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å endpoint, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç PostgREST:

```typescript
// –í–º–µ—Å—Ç–æ:
const { data } = await supabase.from('catalog_categories').select('*');

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º–æ–π SQL —á–µ—Ä–µ–∑ MCP –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π endpoint:
const response = await fetch('/api/catalog/categories-direct');
const { categories } = await response.json();
```

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Å–ª–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ö—ç—à–∞

–ö–æ–≥–¥–∞ PostgREST –æ–±–Ω–æ–≤–∏—Ç –∫—ç—à, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –û—Å–Ω–æ–≤–Ω–æ–π API Endpoint
```bash
curl http://localhost:3001/api/catalog/categories | jq '.stats'
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "total": 41,
  "byLevel": {
    "0": 8,
    "1": 33,
    "2": 0
  },
  "totalProducts": 0,
  "totalSuppliers": 0
}
```

### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –£—Ä–æ–≤–Ω—é
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
curl "http://localhost:3001/api/catalog/categories?level=0" | jq '.categories | length'
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: 8

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
curl "http://localhost:3001/api/catalog/categories?level=1" | jq '.categories | length'
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: 33
```

### 3. –î–µ—Ä–µ–≤–æ –ö–∞—Ç–µ–≥–æ—Ä–∏–π
```bash
curl "http://localhost:3001/api/catalog/categories?includeTree=true" | jq '.categoryTree[0]'
```

–û–∂–∏–¥–∞–µ—Ç—Å—è –¥–µ—Ä–µ–≤–æ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ children:
```json
{
  "category": {
    "name": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
    "level": 0,
    "...": "..."
  },
  "children": [
    {
      "category": {
        "name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –ø–ª–∞–Ω—à–µ—Ç—ã",
        "level": 1,
        "parent_id": "...",
        "full_path": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ / –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –ø–ª–∞–Ω—à–µ—Ç—ã"
      },
      "children": []
    },
    ...
  ]
}
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ü–æ—Å–ª–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è PostgREST –ö—ç—à–∞:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UI:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞: http://localhost:3001/catalog
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º

2. **–û–±–Ω–æ–≤–∏—Ç—å Frontend –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é
   - –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `full_path`
   - –§–∏–ª—å—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å `level`

3. **–î–æ–±–∞–≤–∏—Ç—å –¢–µ—Å—Ç–æ–≤—ã–µ –î–∞–Ω–Ω—ã–µ:**
   - –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—á—ë—Ç—á–∏–∫–æ–≤ `products_count`
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É `suppliers_count`

4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ 103-105 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   –ï—Å–ª–∏ –≤ –ë–î –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã/–ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
   ```sql
   -- 103: Categorize existing products
   -- 104: Categorize existing suppliers
   -- 105: Fix supplier profiles
   ```

---

## üìÅ –§–∞–π–ª—ã –ú–∏–≥—Ä–∞—Ü–∏–π

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤: `/supabase/migrations-v2-safe/`

- `20251030_000_create_catalog_base.sql` - –±–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `20251030_100_extend_catalog_categories.sql` - –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
- `20251030_101_create_category_triggers.sql` - —Ç—Ä–∏–≥–≥–µ—Ä—ã
- `20251030_102_seed_subcategories.sql` - 33 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `20251030_106_create_tree_function.sql` - SQL —Ñ—É–Ω–∫—Ü–∏—è –¥–µ—Ä–µ–≤–∞
- `create_get_categories_json.sql` - JSON —Ñ—É–Ω–∫—Ü–∏—è (–¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞)
- `create_get_all_categories_function.sql` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

---

## üß™ SQL –¢–µ—Å—Ç—ã

–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤: `/supabase/tests/test_category_migrations.sql`

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:
```bash
# –ß–µ—Ä–µ–∑ MCP
supabase db execute -f supabase/tests/test_category_migrations.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ psql
psql <connection-string> -f supabase/tests/test_category_migrations.sql
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã (–≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç)
2. ‚úÖ –ù–∞–ª–∏—á–∏–µ 8+ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. ‚úÖ –ù–∞–ª–∏—á–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
4. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å parent_id —Å—Å—ã–ª–æ–∫
5. ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å full_path
6. ‚úÖ –†–∞–±–æ—Ç—É —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

---

## üìû –ß—Ç–æ –°–æ–æ–±—â–∏—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–°–µ–π—á–∞—Å –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ (41 –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å 3-—É—Ä–æ–≤–Ω–µ–≤–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–µ–π)
- ‚úÖ –í—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ SQL —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã

**–ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç –¥–ª—è:**
- ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PostgREST –∫—ç—à–∞
- ‚è≥ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ REST API

**–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞:**
- –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001/catalog
- –í—ã —É–≤–∏–¥–∏—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é: –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- API –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å level, parent_id, full_path

---

## üêõ –ï—Å–ª–∏ –ü—Ä–æ–±–ª–µ–º—ã –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API —á–µ—Ä–µ–∑ Dashboard
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgREST: `/api/catalog/categories` –¥–æ–ª–∂–µ–Ω –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π endpoint: `/api/catalog/categories-direct`
5. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Supabase, –µ—Å–ª–∏ –∫—ç—à –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è > 30 –º–∏–Ω—É—Ç

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 30.10.2025, 20:36 MSK
